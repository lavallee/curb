{"id":"curb-0b5","title":"Integrate logger into main loop","description":"## Context\nThe main loop needs to call logging functions at the right points.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 20m\n**Approach:** Add logger_init at startup, wrap task execution with log_task_start/end.\n\n## Implementation Steps\n1. Source lib/logger.sh in curb\n2. Call logger_init with project name and session ID\n3. Before harness_invoke: call log_task_start\n4. After harness_invoke: call log_task_end with results\n5. On errors: call log_error\n\n## Acceptance Criteria\n- [ ] Running curb creates log file\n- [ ] Each task iteration produces start/end log entries\n- [ ] Log includes harness, task_id, duration\n\n## Files Likely Involved\n- curb (main script)\n- lib/logger.sh\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:29.967578-05:00","created_by":"lavallee","updated_at":"2026-01-09T21:11:56.301123-05:00","closed_at":"2026-01-09T21:11:56.301123-05:00","close_reason":"Integrated logger into main loop with log_task_start, log_task_end, and log_error functions","labels":["complexity:medium","logic","model:sonnet","phase-1"],"dependencies":[{"issue_id":"curb-0b5","depends_on_id":"curb-ohp","type":"blocks","created_at":"2026-01-09T16:26:30.083603-05:00","created_by":"lavallee"},{"issue_id":"curb-0b5","depends_on_id":"curb-13j","type":"blocks","created_at":"2026-01-09T16:26:30.136331-05:00","created_by":"lavallee"},{"issue_id":"curb-0b5","depends_on_id":"curb-1gq","type":"parent-child","created_at":"2026-01-09T19:57:34.213912-05:00","created_by":"lavallee"}]}
{"id":"curb-0hz","title":"Extract token usage from Claude harness output","description":"## Context\nNeed to get actual token counts from Claude Code to track budget accurately.\n\n## Implementation Hints\n\n**Recommended Model:** opus\n**Estimated Duration:** 45m\n**Approach:** Claude's stream-json output includes usage info. Parse from result event.\n\n## Implementation Steps\n1. Examine Claude Code's stream-json output for token fields\n2. In claude_invoke_streaming, capture and return token usage\n3. Add harness_get_usage() interface that returns tokens\n4. Handle case where usage not available (estimate)\n5. For non-streaming mode, check if --json output has usage\n\n## Acceptance Criteria\n- [ ] Token count extracted from Claude streaming output\n- [ ] Returned in structured format (input_tokens, output_tokens)\n- [ ] Fallback to estimate if not available\n- [ ] Works with both streaming and non-streaming modes\n\n## Files Likely Involved\n- lib/harness.sh\n\n## Notes\nClaude Code result event has cost_usd - may need to calculate tokens from cost.\nThis is a complex task requiring careful parsing of streaming JSON output.\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-09T16:26:46.882399-05:00","created_by":"lavallee","updated_at":"2026-01-09T23:21:36.886671-05:00","closed_at":"2026-01-09T23:21:36.886671-05:00","close_reason":"Implemented token usage extraction from Claude harness output. Added harness_get_usage() interface returning {input_tokens, output_tokens, cache_read_tokens, cache_creation_tokens, cost_usd, estimated}. Supports both streaming (claude_parse_stream) and non-streaming (claude_invoke) modes. Includes fallback estimation from cost_usd when token counts unavailable. Added 14 new tests.","labels":["complexity:high","logic","model:opus","phase-2"],"dependencies":[{"issue_id":"curb-0hz","depends_on_id":"curb-4l8","type":"blocks","created_at":"2026-01-09T16:26:46.995526-05:00","created_by":"lavallee"},{"issue_id":"curb-0hz","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.632587-05:00","created_by":"lavallee"}]}
{"id":"curb-0pb","title":"Reliability: Clean State and Budget Enforcement","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-09T16:26:45.965843-05:00","created_by":"lavallee","updated_at":"2026-01-10T07:13:16.530809-05:00","closed_at":"2026-01-10T07:13:16.530809-05:00","close_reason":"All children completed - Phase 2 (Reliability) finished","labels":["phase-2"]}
{"id":"curb-0u2","title":"Add config file loading with global + project merge","description":"## Context\nConfig needs to merge from multiple sources with clear precedence.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Use jq to merge objects. Load global first, overlay project config.\n\n## Implementation Steps\n1. In config_load(), check for ~/.config/curb/config.json\n2. Check for .curb/config.json in project\n3. Merge with jq: global then project (project wins)\n4. Also check env vars (CURB_*) and apply as overrides\n5. Store merged result in _CONFIG_CACHE\n\n## Acceptance Criteria\n- [ ] Global config alone works\n- [ ] Project config overrides global values\n- [ ] Missing config files handled gracefully (empty default)\n- [ ] CURB_BUDGET env var overrides config budget\n\n## Files Likely Involved\n- lib/config.sh\n\n## Notes\nPrecedence: CLI flags \u003e env vars \u003e project config \u003e global config\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-09T16:26:29.246746-05:00","created_by":"lavallee","updated_at":"2026-01-09T21:01:52.535787-05:00","closed_at":"2026-01-09T21:01:52.535787-05:00","close_reason":"Environment variable override support was already implemented. Config merging with global + project + env vars is complete. All 143 tests pass including CURB_BUDGET env var tests.","labels":["complexity:medium","logic","model:sonnet","phase-1"],"dependencies":[{"issue_id":"curb-0u2","depends_on_id":"curb-1l6","type":"blocks","created_at":"2026-01-09T16:26:29.362116-05:00","created_by":"lavallee"},{"issue_id":"curb-0u2","depends_on_id":"curb-1gq","type":"parent-child","created_at":"2026-01-09T19:57:34.010925-05:00","created_by":"lavallee"}]}
{"id":"curb-0ub","title":"Add --budget flag to curb CLI","description":"## Context\nUsers need to set a token budget for the current run via CLI.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 15m\n**Approach:** Add flag parsing in getopts section, pass to budget_init.\n\n## Implementation Steps\n1. Add --budget to getopts parsing\n2. Store value in BUDGET variable\n3. Call budget_init with value (or config default)\n4. Add to --help output\n\n## Acceptance Criteria\n- [ ] curb --budget 1000000 sets budget\n- [ ] Default from config if no flag\n- [ ] Shows in --help\n\n## Files Likely Involved\n- curb (main script)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:46.714099-05:00","created_by":"lavallee","updated_at":"2026-01-09T23:46:14.962085-05:00","closed_at":"2026-01-09T23:46:14.962085-05:00","close_reason":"Implemented --budget flag parsing and integration with budget_init","labels":["complexity:low","model:haiku","phase-2","ui"],"dependencies":[{"issue_id":"curb-0ub","depends_on_id":"curb-4l8","type":"blocks","created_at":"2026-01-09T16:26:46.824382-05:00","created_by":"lavallee"},{"issue_id":"curb-0ub","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.579959-05:00","created_by":"lavallee"}]}
{"id":"curb-13j","title":"Integrate config into main curb script","description":"## Context\nThe main curb script needs to load config at startup and use it for settings.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 20m\n**Approach:** Source config.sh early, call config_load, replace hardcoded defaults with config_get_or calls.\n\n## Implementation Steps\n1. Source lib/config.sh after lib/xdg.sh\n2. Call config_load in initialization\n3. Replace HARNESS default with config_get_or \"harness.default\" \"auto\"\n4. Replace MAX_ITERATIONS with config value\n5. Pass through to other libs as needed\n\n## Acceptance Criteria\n- [ ] curb respects config file harness priority\n- [ ] curb respects config file max_iterations\n- [ ] CLI flags still override config values\n\n## Files Likely Involved\n- curb (main script)\n- lib/config.sh\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:29.784672-05:00","created_by":"lavallee","updated_at":"2026-01-09T21:05:19.678795-05:00","closed_at":"2026-01-09T21:05:19.678795-05:00","close_reason":"Config integration complete - curb now loads config at startup and uses config values for harness.default and loop.max_iterations, with CLI flags and env vars taking precedence","labels":["complexity:medium","logic","model:sonnet","phase-1"],"dependencies":[{"issue_id":"curb-13j","depends_on_id":"curb-0u2","type":"blocks","created_at":"2026-01-09T16:26:29.904724-05:00","created_by":"lavallee"},{"issue_id":"curb-13j","depends_on_id":"curb-1gq","type":"parent-child","created_at":"2026-01-09T19:57:34.163036-05:00","created_by":"lavallee"}]}
{"id":"curb-1gq","title":"Foundation: Config and Logging Infrastructure","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-01-09T16:26:12.985368-05:00","created_by":"lavallee","updated_at":"2026-01-09T22:44:26.173547-05:00","closed_at":"2026-01-09T22:44:26.173547-05:00","close_reason":"All child tasks complete: XDG directory structure, config.sh interface, config file loading with merge, logger.sh with JSONL output, task logging functions, config integration, logger integration, global onboarding, and Phase 1 checkpoint validation. All 189 tests passing.","labels":["phase-1"]}
{"id":"curb-1l6","title":"Implement config.sh with config_get interface","description":"## Context\nNeed a simple interface to read config values with dot-notation keys.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Use jq for JSON parsing. Cache loaded config in a variable to avoid re-reading.\n\n## Implementation Steps\n1. Create lib/config.sh\n2. Add _CONFIG_CACHE variable for loaded config\n3. Add config_load() - reads and merges config files\n4. Add config_get(key) - uses jq to extract value by dot-path\n5. Add config_get_or(key, default) - with fallback\n\n## Acceptance Criteria\n- [ ] config_get \"harness.priority\" returns array\n- [ ] config_get \"budget.default\" returns number\n- [ ] config_get \"nonexistent\" returns empty\n- [ ] config_get_or \"nonexistent\" \"fallback\" returns \"fallback\"\n\n## Files Likely Involved\n- lib/config.sh (new)\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-09T16:26:29.068278-05:00","created_by":"lavallee","updated_at":"2026-01-09T20:34:33.66378-05:00","closed_at":"2026-01-09T20:34:33.66378-05:00","close_reason":"Implemented config.sh with config_get interface - all acceptance criteria met","labels":["complexity:medium","logic","model:sonnet","phase-1"],"dependencies":[{"issue_id":"curb-1l6","depends_on_id":"curb-iwv","type":"blocks","created_at":"2026-01-09T16:26:29.184348-05:00","created_by":"lavallee"},{"issue_id":"curb-1l6","depends_on_id":"curb-1gq","type":"parent-child","created_at":"2026-01-09T19:57:33.962311-05:00","created_by":"lavallee"}]}
{"id":"curb-2d6","title":"Improve --help output","description":"## Context\n--help should show all new flags and features.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 15m\n**Approach:** Update usage() function with new flags.\n\n## Implementation Steps\n1. Add --budget to help\n2. Add --require-clean to help\n3. Group flags by category (Core, Reliability, Debug)\n4. Add examples section\n\n## Acceptance Criteria\n- [ ] All new flags in --help\n- [ ] Grouped logically\n- [ ] Examples helpful\n\n## Files Likely Involved\n- curb\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-09T16:27:20.765482-05:00","created_by":"lavallee","updated_at":"2026-01-10T07:05:06.050452-05:00","closed_at":"2026-01-10T07:05:06.050452-05:00","close_reason":"Improved --help output with categorized flags, examples, and comprehensive documentation","labels":["complexity:low","model:haiku","phase-4","ui"],"dependencies":[{"issue_id":"curb-2d6","depends_on_id":"curb-ch2","type":"blocks","created_at":"2026-01-09T16:27:20.87661-05:00","created_by":"lavallee"},{"issue_id":"curb-2d6","depends_on_id":"curb-9pe","type":"parent-child","created_at":"2026-01-09T19:57:35.493578-05:00","created_by":"lavallee"}]}
{"id":"curb-3s0","title":"Implement Gemini harness","description":"## Context\nAdd Gemini as a supported harness based on spike findings.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Follow pattern from claude/codex implementations in harness.sh.\n\n## Implementation Steps\n1. Add gemini_invoke() function\n2. Add gemini_invoke_streaming() if supported\n3. Handle system prompt passing\n4. Add to harness_detect() priority list\n5. Update harness_available() check\n\n## Acceptance Criteria\n- [ ] curb --harness gemini works\n- [ ] System and task prompts passed correctly\n- [ ] Streaming mode if available\n- [ ] Falls back gracefully if not installed\n\n## Files Likely Involved\n- lib/harness.sh\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:27:05.16602-05:00","created_by":"lavallee","updated_at":"2026-01-10T05:11:40.62771-05:00","closed_at":"2026-01-10T05:11:40.62771-05:00","close_reason":"Implemented Gemini harness with gemini_invoke() and gemini_invoke_streaming() functions, updated harness detection and routing. All 301 tests pass.","labels":["complexity:medium","logic","model:sonnet","phase-3"],"dependencies":[{"issue_id":"curb-3s0","depends_on_id":"curb-4wz","type":"blocks","created_at":"2026-01-09T16:27:05.276961-05:00","created_by":"lavallee"},{"issue_id":"curb-3s0","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:35.043973-05:00","created_by":"lavallee"}]}
{"id":"curb-4l8","title":"Implement budget.sh with token tracking","description":"## Context\nTrack cumulative token usage across loop iterations to enforce spending limits.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Simple counter stored in variable. Functions to init, record, check.\n\n## Implementation Steps\n1. Create lib/budget.sh\n2. Add _BUDGET_LIMIT and _BUDGET_USED variables\n3. Add budget_init(limit) - sets the budget for this run\n4. Add budget_record(tokens) - adds to cumulative usage\n5. Add budget_check() - returns 1 if over budget\n6. Add budget_remaining() - echoes remaining tokens\n\n## Acceptance Criteria\n- [ ] budget_init sets limit correctly\n- [ ] budget_record accumulates usage\n- [ ] budget_check returns 1 when over\n- [ ] budget_remaining shows correct value\n\n## Files Likely Involved\n- lib/budget.sh (new)\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-09T16:26:46.538795-05:00","created_by":"lavallee","updated_at":"2026-01-09T22:59:53.444847-05:00","closed_at":"2026-01-09T22:59:53.444847-05:00","close_reason":"Implemented budget.sh with token tracking. All tests passing (24 new tests, 231 total).","labels":["complexity:medium","logic","model:sonnet","phase-2"],"dependencies":[{"issue_id":"curb-4l8","depends_on_id":"curb-hp9","type":"blocks","created_at":"2026-01-09T16:26:46.65066-05:00","created_by":"lavallee"},{"issue_id":"curb-4l8","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.52684-05:00","created_by":"lavallee"}]}
{"id":"curb-4wz","title":"Spike: Research Gemini CLI interface","description":"## Context\nNeed to understand Gemini CLI before implementing harness.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Install Gemini CLI, test invocation patterns, document findings.\n\n## Implementation Steps\n1. Research Gemini CLI installation (likely gcloud or standalone)\n2. Test basic invocation with prompt\n3. Document flags for: auto mode, system prompt, streaming\n4. Check for usage/token reporting\n5. Note any significant differences from Claude/Codex\n\n## Acceptance Criteria\n- [ ] Installation method documented\n- [ ] Basic invocation working\n- [ ] Flags mapped to curb needs\n- [ ] Token reporting capability assessed\n- [ ] Findings written to .chopshop/spikes/gemini.md\n\n## Files Likely Involved\n- .chopshop/spikes/gemini.md (new)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:27:04.999717-05:00","created_by":"lavallee","updated_at":"2026-01-10T05:04:47.689616-05:00","closed_at":"2026-01-10T05:04:47.689616-05:00","close_reason":"Research complete: documented Gemini CLI installation, flags, YOLO mode, system prompt approach, and token reporting limitations in .chopshop/spikes/gemini.md","labels":["complexity:medium","experiment","model:sonnet","phase-3","research"],"dependencies":[{"issue_id":"curb-4wz","depends_on_id":"curb-fxr","type":"blocks","created_at":"2026-01-09T16:27:05.107089-05:00","created_by":"lavallee"},{"issue_id":"curb-4wz","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:34.991728-05:00","created_by":"lavallee"}]}
{"id":"curb-61a","title":"Checkpoint: Curb 1.0 Ready for Release","description":"## Final Validation\n\nAll phases complete. Curb 1.0 is ready for release.\n\n## What's Ready\n- Config: global and project configuration\n- Logging: structured JSONL logs\n- Reliability: clean state, budget enforcement\n- Hooks: 5 lifecycle extension points\n- Harnesses: Claude, Codex, Gemini, OpenCode\n- Documentation: README, examples, migration guide\n\n## Release Checklist\n- [ ] All tests passing\n- [ ] README reviewed and accurate\n- [ ] CHANGELOG updated\n- [ ] Version bumped to 1.0.0\n- [ ] Git tag created\n- [ ] Announcement drafted\n\n## Suggested Final Testing\n- [ ] Fresh install on new machine\n- [ ] Run through quick start guide\n- [ ] Complete a multi-task project\n- [ ] Verify budget tracking accurate\n- [ ] Test one hook end-to-end\n\n## Celebrate!\nCurb 1.0 is reliable, extensible, and documented. Ship it!\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:27:21.49355-05:00","created_by":"lavallee","updated_at":"2026-01-10T07:12:34.226368-05:00","closed_at":"2026-01-10T07:12:34.226368-05:00","close_reason":"Version 1.0.0 released with complete documentation, testing, and tag","labels":["checkpoint","phase-4"],"dependencies":[{"issue_id":"curb-61a","depends_on_id":"curb-2d6","type":"blocks","created_at":"2026-01-09T16:27:21.600981-05:00","created_by":"lavallee"},{"issue_id":"curb-61a","depends_on_id":"curb-ehj","type":"blocks","created_at":"2026-01-09T16:27:21.652427-05:00","created_by":"lavallee"},{"issue_id":"curb-61a","depends_on_id":"curb-a4p","type":"blocks","created_at":"2026-01-09T16:27:21.69912-05:00","created_by":"lavallee"},{"issue_id":"curb-61a","depends_on_id":"curb-god","type":"blocks","created_at":"2026-01-09T16:27:21.74699-05:00","created_by":"lavallee"},{"issue_id":"curb-61a","depends_on_id":"curb-9pe","type":"parent-child","created_at":"2026-01-09T19:57:35.699226-05:00","created_by":"lavallee"}]}
{"id":"curb-9pe","title":"Polish: Documentation and User Experience","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-09T16:27:20.367533-05:00","created_by":"lavallee","updated_at":"2026-01-10T07:13:16.570955-05:00","closed_at":"2026-01-10T07:13:16.570955-05:00","close_reason":"All children completed - Phase 4 (Polish) finished","labels":["phase-4"]}
{"id":"curb-a4p","title":"Document config schema","description":"## Context\nUsers need reference docs for all config options.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 20m\n**Approach:** Create a config reference with all options and defaults.\n\n## Implementation Steps\n1. Create docs/CONFIG.md\n2. Document each config section\n3. List all options with types and defaults\n4. Add examples for common scenarios\n5. Link from README\n\n## Acceptance Criteria\n- [ ] All config options documented\n- [ ] Types and defaults clear\n- [ ] Examples for common cases\n- [ ] Searchable/scannable format\n\n## Files Likely Involved\n- docs/CONFIG.md (new)\n- README.md (link)\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:27:21.109341-05:00","created_by":"lavallee","updated_at":"2026-01-10T06:48:05.948886-05:00","closed_at":"2026-01-10T06:48:05.948886-05:00","close_reason":"Closed","labels":["complexity:low","docs","model:haiku","phase-4"],"dependencies":[{"issue_id":"curb-a4p","depends_on_id":"curb-ch2","type":"blocks","created_at":"2026-01-09T16:27:21.222115-05:00","created_by":"lavallee"},{"issue_id":"curb-a4p","depends_on_id":"curb-9pe","type":"parent-child","created_at":"2026-01-09T19:57:35.595225-05:00","created_by":"lavallee"}]}
{"id":"curb-ch2","title":"Checkpoint: Extensibility Complete","description":"## Pause for Validation\n\nPhase 3 is complete. Curb now supports customization and multiple harnesses.\n\n## What's Ready\n- 5 hook points (pre-loop, pre-task, post-task, on-error, post-loop)\n- 4 harnesses (Claude, Codex, Gemini, OpenCode)\n- Harness capability detection\n- Token tracking across all harnesses\n\n## Suggested Testing\n- [ ] Create a pre-task hook that logs to a file, verify it runs\n- [ ] Test each harness with curb --harness X --once\n- [ ] Verify budget tracking works with different harnesses\n- [ ] Try harness priority config\n\n## Questions for Feedback\n- Are the hook points sufficient? Any missing?\n- Are all 4 harnesses working reliably?\n- Is the capability detection useful in practice?\n\n## Key Milestone\nAfter this checkpoint, curb is feature-complete for 1.0!\n\n## Next Steps\nIf approved, proceed to Phase 4: Polish (docs, examples, UX)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:27:06.241126-05:00","created_by":"lavallee","updated_at":"2026-01-10T06:15:17.834978-05:00","closed_at":"2026-01-10T06:15:17.834978-05:00","close_reason":"Phase 3 checkpoint validated: All 5 hooks, 4 harnesses, capability detection, and token tracking working correctly. 327 tests passing.","labels":["checkpoint","phase-3"],"dependencies":[{"issue_id":"curb-ch2","depends_on_id":"curb-ffn","type":"blocks","created_at":"2026-01-09T16:27:06.350222-05:00","created_by":"lavallee"},{"issue_id":"curb-ch2","depends_on_id":"curb-fpg","type":"blocks","created_at":"2026-01-09T16:27:06.395885-05:00","created_by":"lavallee"},{"issue_id":"curb-ch2","depends_on_id":"curb-tw9","type":"blocks","created_at":"2026-01-09T16:27:06.443782-05:00","created_by":"lavallee"},{"issue_id":"curb-ch2","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:35.34593-05:00","created_by":"lavallee"}]}
{"id":"curb-co7","title":"Implement state.sh with git clean check","description":"## Context\nAfter each task, verify the harness left the repo in a clean state (committed its changes).\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Use git status/diff to check for uncommitted changes. Configurable behavior (warn vs fail).\n\n## Implementation Steps\n1. Create lib/state.sh\n2. Add state_is_clean() - returns 0 if no uncommitted changes\n3. Add state_ensure_clean() - checks and acts based on config\n4. Read require_commit from config\n5. Log warning or error appropriately\n\n## Acceptance Criteria\n- [ ] Detects uncommitted changes after harness run\n- [ ] Respects clean_state.require_commit config\n- [ ] Clear error message pointing to uncommitted files\n\n## Files Likely Involved\n- lib/state.sh (new)\n- lib/config.sh (for reading settings)\n\n## Notes\ngit diff --quiet HEAD returns 0 if clean, 1 if changes\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-09T16:26:46.024899-05:00","created_by":"lavallee","updated_at":"2026-01-09T22:53:45.529916-05:00","closed_at":"2026-01-09T22:53:45.529916-05:00","close_reason":"Implemented state.sh with state_is_clean() and state_ensure_clean() functions. Respects clean_state.require_commit config. All 18 tests pass.","labels":["complexity:medium","logic","model:sonnet","phase-2"],"dependencies":[{"issue_id":"curb-co7","depends_on_id":"curb-hp9","type":"blocks","created_at":"2026-01-09T16:26:46.136032-05:00","created_by":"lavallee"},{"issue_id":"curb-co7","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.360603-05:00","created_by":"lavallee"}]}
{"id":"curb-d9l","title":"Spike: Research OpenCode CLI interface","description":"## Context\nNeed to understand OpenCode CLI before implementing harness.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Install OpenCode CLI, test invocation patterns, document findings.\n\n## Implementation Steps\n1. Research OpenCode CLI installation\n2. Test basic invocation with prompt\n3. Document flags for: auto mode, system prompt, streaming\n4. Check for usage/token reporting\n5. Note differences from other harnesses\n\n## Acceptance Criteria\n- [ ] Installation method documented\n- [ ] Basic invocation working\n- [ ] Flags mapped to curb needs\n- [ ] Token reporting capability assessed\n- [ ] Findings written to .chopshop/spikes/opencode.md\n\n## Files Likely Involved\n- .chopshop/spikes/opencode.md (new)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:27:05.336474-05:00","created_by":"lavallee","updated_at":"2026-01-10T05:18:38.072491-05:00","closed_at":"2026-01-10T05:18:38.072491-05:00","close_reason":"Completed: OpenCode CLI research spike. Documentation written to .chopshop/spikes/opencode.md with comprehensive findings on installation, invocation, flags, token reporting, and harness implementation recommendations.","labels":["complexity:medium","experiment","model:sonnet","phase-3","research"],"dependencies":[{"issue_id":"curb-d9l","depends_on_id":"curb-fxr","type":"blocks","created_at":"2026-01-09T16:27:05.439719-05:00","created_by":"lavallee"},{"issue_id":"curb-d9l","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:35.096562-05:00","created_by":"lavallee"}]}
{"id":"curb-ehj","title":"Write migration guide for existing users","description":"## Context\nExisting curb users need to know what changed and how to adapt.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 20m\n**Approach:** Document breaking changes, new defaults, migration steps.\n\n## Implementation Steps\n1. Create UPGRADING.md\n2. List breaking changes (if any)\n3. Document new environment variables\n4. Explain new directory structure\n5. Provide step-by-step upgrade process\n\n## Acceptance Criteria\n- [ ] All breaking changes listed\n- [ ] Clear migration steps\n- [ ] Before/after examples\n- [ ] Linked from README\n\n## Files Likely Involved\n- UPGRADING.md (new)\n- README.md (link to it)\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:27:20.939048-05:00","created_by":"lavallee","updated_at":"2026-01-10T06:44:52.086945-05:00","closed_at":"2026-01-10T06:44:52.086957-05:00","labels":["complexity:low","docs","model:haiku","phase-4"],"dependencies":[{"issue_id":"curb-ehj","depends_on_id":"curb-ch2","type":"blocks","created_at":"2026-01-09T16:27:21.050872-05:00","created_by":"lavallee"},{"issue_id":"curb-ehj","depends_on_id":"curb-9pe","type":"parent-child","created_at":"2026-01-09T19:57:35.545029-05:00","created_by":"lavallee"}]}
{"id":"curb-et7","title":"Implement logger.sh with JSONL output","description":"## Context\nStructured logs enable post-run analysis and debugging. JSONL is grep-friendly and jq-queryable.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Simple functions that build JSON and append to log file. Use jq -n for safe JSON construction.\n\n## Implementation Steps\n1. Create lib/logger.sh\n2. Add _LOG_FILE variable (set during init)\n3. Add logger_init(project_name, session_id) - sets up log file path\n4. Add logger_write(event_type, data_json) - appends JSONL line\n5. Ensure log directory exists before writing\n\n## Acceptance Criteria\n- [ ] Log file created at ~/.local/share/curb/logs/{project}/{session}.jsonl\n- [ ] Each line is valid JSON\n- [ ] Timestamps in ISO 8601 format\n- [ ] Log file is append-only\n\n## Files Likely Involved\n- lib/logger.sh (new)\n- lib/xdg.sh (for directory helpers)\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-09T16:26:29.423387-05:00","created_by":"lavallee","updated_at":"2026-01-09T20:49:54.693193-05:00","closed_at":"2026-01-09T20:49:54.693193-05:00","close_reason":"Implemented lib/logger.sh with full JSONL logging functionality. All 24 tests pass. Fixed bash 3.2 compatibility issue with parameter defaults.","labels":["complexity:medium","logic","model:sonnet","phase-1"],"dependencies":[{"issue_id":"curb-et7","depends_on_id":"curb-iwv","type":"blocks","created_at":"2026-01-09T16:26:29.537944-05:00","created_by":"lavallee"},{"issue_id":"curb-et7","depends_on_id":"curb-1gq","type":"parent-child","created_at":"2026-01-09T19:57:34.061136-05:00","created_by":"lavallee"}]}
{"id":"curb-ffn","title":"Implement 5 hook points in main loop","description":"## Context\nIntegrate hooks at 5 lifecycle points in the main curb loop.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Call hooks_run at each point with appropriate context variables exported.\n\n## Implementation Steps\n1. Add pre-loop hook (before first iteration)\n2. Add pre-task hook (before harness_invoke)\n3. Add post-task hook (after harness completes)\n4. Add on-error hook (when harness fails)\n5. Add post-loop hook (after all tasks done)\n6. Export TASK_ID, HARNESS, EXIT_CODE etc for each\n\n## Acceptance Criteria\n- [ ] All 5 hook points fire at correct times\n- [ ] Context variables available to scripts\n- [ ] on-error only fires on actual errors\n- [ ] Hooks can be disabled via config\n\n## Files Likely Involved\n- curb (main script)\n- lib/hooks.sh\n\n## Notes\nContext vars: PROJECT_DIR, TASK_ID, TASK_TITLE, HARNESS, EXIT_CODE, DURATION\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:27:04.825284-05:00","created_by":"lavallee","updated_at":"2026-01-10T04:58:19.728328-05:00","closed_at":"2026-01-10T04:58:19.728328-05:00","close_reason":"Implemented 5 hook points in main loop: pre-loop, pre-task, post-task, on-error, and post-loop. All hooks fire at correct lifecycle points with proper context variables exported.","labels":["complexity:medium","logic","model:sonnet","phase-3"],"dependencies":[{"issue_id":"curb-ffn","depends_on_id":"curb-zrg","type":"blocks","created_at":"2026-01-09T16:27:04.940918-05:00","created_by":"lavallee"},{"issue_id":"curb-ffn","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:34.939269-05:00","created_by":"lavallee"}]}
{"id":"curb-fpg","title":"Extract token usage from Gemini and OpenCode","description":"## Context\nToken tracking needs to work across all harnesses for budget enforcement.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Implement harness-specific token extraction based on spike findings.\n\n## Implementation Steps\n1. Add gemini_get_usage() based on Gemini output format\n2. Add opencode_get_usage() based on OpenCode output format\n3. Update harness_get_usage() to delegate appropriately\n4. Handle missing data gracefully (estimate or return 0)\n5. Test with actual runs\n\n## Acceptance Criteria\n- [ ] Token counts available from Gemini runs\n- [ ] Token counts available from OpenCode runs\n- [ ] Estimation fallback works\n- [ ] Budget tracking accurate across harnesses\n\n## Files Likely Involved\n- lib/harness.sh\n- lib/budget.sh\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:27:05.902312-05:00","created_by":"lavallee","updated_at":"2026-01-10T05:45:54.376472-05:00","closed_at":"2026-01-10T05:45:54.376472-05:00","close_reason":"Implemented token extraction for OpenCode (both modes now extract from JSON) and Gemini (character-based estimation with estimated flag). All 317 tests pass.","labels":["complexity:medium","logic","model:sonnet","phase-3"],"dependencies":[{"issue_id":"curb-fpg","depends_on_id":"curb-kod","type":"blocks","created_at":"2026-01-09T16:27:06.008858-05:00","created_by":"lavallee"},{"issue_id":"curb-fpg","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:35.246581-05:00","created_by":"lavallee"}]}
{"id":"curb-fxr","title":"Checkpoint: Reliability Complete","description":"## Pause for Validation\n\nPhase 2 is complete. Curb can now run unattended with confidence.\n\n## What's Ready\n- Clean state enforcement (uncommitted changes detected)\n- Optional test requirement\n- Token budget tracking\n- Budget enforcement (stops at limit)\n- Budget warnings (at 80%)\n\n## Suggested Testing\n- [ ] Run curb on a project, verify it commits changes\n- [ ] Configure require_tests=true, verify tests run\n- [ ] Set small --budget, verify it stops when exceeded\n- [ ] Check logs show token usage per task\n\n## Questions for Feedback\n- Is the clean state check too strict or not strict enough?\n- Is token counting accurate enough for your needs?\n- Should budget be enforceable per-task as well as per-run?\n\n## Key Milestone\nAfter this checkpoint, curb is reliable enough for overnight runs!\n\n## Next Steps\nIf approved, proceed to Phase 3: Extensibility (hooks, new harnesses)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:47.503293-05:00","created_by":"lavallee","updated_at":"2026-01-10T00:11:30.10182-05:00","closed_at":"2026-01-10T00:11:30.10182-05:00","close_reason":"Phase 2 complete: All reliability features validated. Clean state enforcement, test requirement, token budget tracking, budget enforcement, and budget warnings all working. 273 tests passing, no regressions. Curb ready for unattended runs.","labels":["checkpoint","phase-2"],"dependencies":[{"issue_id":"curb-fxr","depends_on_id":"curb-vdw","type":"blocks","created_at":"2026-01-09T16:26:47.619073-05:00","created_by":"lavallee"},{"issue_id":"curb-fxr","depends_on_id":"curb-iji","type":"blocks","created_at":"2026-01-09T16:26:47.663958-05:00","created_by":"lavallee"},{"issue_id":"curb-fxr","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.787418-05:00","created_by":"lavallee"}]}
{"id":"curb-g21","title":"Add optional test runner integration","description":"## Context\nOptionally require tests to pass before considering a task complete.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Detect test runner from project (package.json scripts, Makefile, etc). Run if configured.\n\n## Implementation Steps\n1. Add state_run_tests() to state.sh\n2. Detect test command: npm test, make test, pytest, etc.\n3. Read clean_state.require_tests from config\n4. Run tests if enabled, capture exit code\n5. Return failure if tests fail\n\n## Acceptance Criteria\n- [ ] Detects test command for npm/yarn/make/pytest projects\n- [ ] Only runs if require_tests is true\n- [ ] Test failures logged clearly\n- [ ] Test output captured in logs\n\n## Files Likely Involved\n- lib/state.sh\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:46.19682-05:00","created_by":"lavallee","updated_at":"2026-01-09T23:30:28.308338-05:00","closed_at":"2026-01-09T23:30:28.308338-05:00","close_reason":"Implemented state_run_tests() with test command detection for npm/yarn/make/pytest/go/cargo/rake. Added state_detect_test_command() helper. All 23 new tests pass (263 total). Detects test runners from project markers (package.json, Makefile, etc). Only runs when clean_state.require_tests=true. Test failures logged with full output and context.","labels":["complexity:medium","logic","model:sonnet","phase-2"],"dependencies":[{"issue_id":"curb-g21","depends_on_id":"curb-co7","type":"blocks","created_at":"2026-01-09T16:26:46.308302-05:00","created_by":"lavallee"},{"issue_id":"curb-g21","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.421345-05:00","created_by":"lavallee"}]}
{"id":"curb-god","title":"End-to-end test: full loop with budget","description":"## Context\nVerify all pieces work together before release.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Create a test project with multiple tasks, run with budget, verify all features.\n\n## Implementation Steps\n1. Create tests/e2e/ directory\n2. Set up test project with 3-5 simple tasks\n3. Add hooks that log to file\n4. Run curb with --budget 100000\n5. Verify: logs created, hooks ran, budget stopped loop\n\n## Acceptance Criteria\n- [ ] Full loop runs to completion or budget\n- [ ] All hooks fire at right times\n- [ ] Logs contain all expected events\n- [ ] Clean state enforced\n- [ ] Can be run in CI\n\n## Files Likely Involved\n- tests/e2e/run.sh (new)\n- tests/e2e/project/ (test fixtures)\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:27:21.281184-05:00","created_by":"lavallee","updated_at":"2026-01-10T06:59:15.186205-05:00","closed_at":"2026-01-10T06:59:15.186205-05:00","close_reason":"Implemented comprehensive e2e test suite with full loop verification, budget tracking, hooks testing, and CI support","labels":["complexity:medium","model:sonnet","phase-4","test"],"dependencies":[{"issue_id":"curb-god","depends_on_id":"curb-gp6","type":"blocks","created_at":"2026-01-09T16:27:21.389113-05:00","created_by":"lavallee"},{"issue_id":"curb-god","depends_on_id":"curb-zlk","type":"blocks","created_at":"2026-01-09T16:27:21.435829-05:00","created_by":"lavallee"},{"issue_id":"curb-god","depends_on_id":"curb-9pe","type":"parent-child","created_at":"2026-01-09T19:57:35.64475-05:00","created_by":"lavallee"}]}
{"id":"curb-gp6","title":"Write example hooks (slack, datadog, pagerduty)","description":"## Context\nExample hooks help users understand the pattern and get started quickly.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 30m\n**Approach:** Create simple, well-commented example scripts.\n\n## Implementation Steps\n1. Create examples/hooks/ directory\n2. Add post-task/slack-notify.sh - posts to webhook\n3. Add post-loop/datadog-metric.sh - sends completion metric\n4. Add on-error/pagerduty-alert.sh - alerts on failure\n5. Document in each script how to install\n\n## Acceptance Criteria\n- [ ] 3+ example hooks created\n- [ ] Each well-commented with usage instructions\n- [ ] Demonstrates accessing context variables\n- [ ] Documented in README\n\n## Files Likely Involved\n- examples/hooks/post-task/slack-notify.sh (new)\n- examples/hooks/post-loop/datadog-metric.sh (new)\n- examples/hooks/on-error/pagerduty-alert.sh (new)\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:27:20.427568-05:00","created_by":"lavallee","updated_at":"2026-01-10T06:34:36.668026-05:00","closed_at":"2026-01-10T06:34:36.668026-05:00","close_reason":"Implemented 3 example hooks (Slack, Datadog, PagerDuty) with detailed documentation and usage instructions. Updated README with comprehensive hooks documentation including installation instructions, context variables, and custom hook writing guide.","labels":["complexity:low","docs","model:haiku","phase-4"],"dependencies":[{"issue_id":"curb-gp6","depends_on_id":"curb-ch2","type":"blocks","created_at":"2026-01-09T16:27:20.541094-05:00","created_by":"lavallee"},{"issue_id":"curb-gp6","depends_on_id":"curb-9pe","type":"parent-child","created_at":"2026-01-09T19:57:35.395762-05:00","created_by":"lavallee"}]}
{"id":"curb-hp9","title":"Checkpoint: Config and Logging Complete","description":"## Pause for Validation\n\nPhase 1 is complete. Before proceeding to reliability features, validate:\n\n## What's Ready\n- Global config at ~/.config/curb/config.json\n- Project config at .curb/config.json\n- Structured JSONL logs after each run\n- curb init --global onboarding\n\n## Suggested Testing\n- [ ] Run curb init --global and verify config created\n- [ ] Create a project config that overrides a global setting\n- [ ] Run curb on a test project and check logs created\n- [ ] Query logs with jq: jq 'select(.event==\"task_end\")' logs/*.jsonl\n\n## Questions for Feedback\n- Is the config schema intuitive?\n- Are the logs capturing the right metadata?\n- Any settings that should be configurable but aren't?\n\n## Next Steps\nIf approved, proceed to Phase 2: Reliability (clean state, budget tracking)\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:30.373475-05:00","created_by":"lavallee","updated_at":"2026-01-09T22:00:52.883049-05:00","closed_at":"2026-01-09T22:00:52.883049-05:00","close_reason":"Phase 1 validation complete. All features working: global config, project config override, structured logs, curb init --global. All 189 tests passing.","labels":["checkpoint","phase-1"],"dependencies":[{"issue_id":"curb-hp9","depends_on_id":"curb-0b5","type":"blocks","created_at":"2026-01-09T16:26:30.485158-05:00","created_by":"lavallee"},{"issue_id":"curb-hp9","depends_on_id":"curb-kiz","type":"blocks","created_at":"2026-01-09T16:26:30.533676-05:00","created_by":"lavallee"},{"issue_id":"curb-hp9","depends_on_id":"curb-1gq","type":"parent-child","created_at":"2026-01-09T19:57:34.311792-05:00","created_by":"lavallee"}]}
{"id":"curb-htk","title":"Extensibility: Hooks and New Harnesses","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-09T16:27:04.418674-05:00","created_by":"lavallee","updated_at":"2026-01-10T06:15:20.723175-05:00","closed_at":"2026-01-10T06:15:20.723175-05:00","close_reason":"Phase 3 complete: Extensibility framework fully implemented with 5 hook points, 4 harnesses (Claude, Codex, Gemini, OpenCode), capability detection system, and comprehensive token tracking.","labels":["phase-3"]}
{"id":"curb-iji","title":"Add budget warning at threshold","description":"## Context\nWarn users when approaching budget limit so they can decide to stop.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 15m\n**Approach:** Check if usage \u003e warn_at threshold, log warning once.\n\n## Implementation Steps\n1. Add budget_check_warning() function\n2. Read warn_at from config (default 80% of budget)\n3. Track if warning already shown (_BUDGET_WARNED)\n4. Log warning when threshold crossed\n5. Call after budget_record in main loop\n\n## Acceptance Criteria\n- [ ] Warning shown when crossing 80% threshold\n- [ ] Warning only shown once per run\n- [ ] Threshold configurable in config\n\n## Files Likely Involved\n- lib/budget.sh\n- curb (main script)\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:26:47.328394-05:00","created_by":"lavallee","updated_at":"2026-01-10T00:01:56.102708-05:00","closed_at":"2026-01-10T00:01:56.102708-05:00","close_reason":"Implemented budget warning at threshold with configurable warn_at config","labels":["complexity:low","model:haiku","phase-2","ui"],"dependencies":[{"issue_id":"curb-iji","depends_on_id":"curb-rvl","type":"blocks","created_at":"2026-01-09T16:26:47.444102-05:00","created_by":"lavallee"},{"issue_id":"curb-iji","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.734293-05:00","created_by":"lavallee"}]}
{"id":"curb-iwv","title":"Create XDG directory structure and helpers","description":"## Context\nCurb needs standard locations for global config, logs, and cache following XDG Base Directory spec.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 15m\n**Approach:** Simple bash functions that expand XDG vars with fallbacks. Copy pattern from other CLI tools.\n\n## Implementation Steps\n1. Create lib/xdg.sh with helper functions\n2. Add xdg_config_home() - returns ~/.config or $XDG_CONFIG_HOME\n3. Add xdg_data_home() - returns ~/.local/share or $XDG_DATA_HOME\n4. Add curb_ensure_dirs() - creates curb subdirs if missing\n5. Source from main curb script\n\n## Acceptance Criteria\n- [ ] xdg_config_home returns correct path\n- [ ] xdg_data_home returns correct path\n- [ ] curb_ensure_dirs creates ~/.config/curb and ~/.local/share/curb/logs\n\n## Files Likely Involved\n- lib/xdg.sh (new)\n- curb (source the new lib)\n\n## Notes\nXDG spec: https://specifications.freedesktop.org/basedir-spec/latest/\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-09T16:26:28.931923-05:00","created_by":"lavallee","updated_at":"2026-01-09T20:26:21.578261-05:00","closed_at":"2026-01-09T20:26:21.578261-05:00","close_reason":"Closed","labels":["complexity:low","model:haiku","phase-1","setup"],"dependencies":[{"issue_id":"curb-iwv","depends_on_id":"curb-1gq","type":"parent-child","created_at":"2026-01-09T19:57:33.912027-05:00","created_by":"lavallee"}]}
{"id":"curb-kiz","title":"Add curb init --global for onboarding","description":"## Context\nNew users need an easy way to set up global curb config and verify dependencies.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Interactive prompts that create config file. Check for jq, harnesses.\n\n## Implementation Steps\n1. Add --global flag handling to curb-init\n2. Check dependencies (jq, at least one harness)\n3. Create ~/.config/curb/ directory structure\n4. Generate config.json with sensible defaults\n5. Create hooks directories\n6. Print success message with next steps\n\n## Acceptance Criteria\n- [ ] curb init --global creates ~/.config/curb/config.json\n- [ ] Missing dependencies are reported clearly\n- [ ] Config has sensible defaults for budget, harness priority\n- [ ] Hook directories created\n\n## Files Likely Involved\n- curb-init\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:30.196969-05:00","created_by":"lavallee","updated_at":"2026-01-09T21:45:25.399313-05:00","closed_at":"2026-01-09T21:45:25.399313-05:00","close_reason":"Implemented curb init --global with dependency checking, directory structure creation, config file generation with sensible defaults, and hook directories. All acceptance criteria met.","labels":["complexity:medium","model:sonnet","phase-1","setup"],"dependencies":[{"issue_id":"curb-kiz","depends_on_id":"curb-0u2","type":"blocks","created_at":"2026-01-09T16:26:30.311666-05:00","created_by":"lavallee"},{"issue_id":"curb-kiz","depends_on_id":"curb-1gq","type":"parent-child","created_at":"2026-01-09T19:57:34.262909-05:00","created_by":"lavallee"}]}
{"id":"curb-kod","title":"Add harness capability detection","description":"## Context\nDifferent harnesses have different capabilities. Need to detect and adapt.\n\n## Implementation Hints\n\n**Recommended Model:** opus\n**Estimated Duration:** 30m\n**Approach:** Create capability interface that each harness implements.\n\n## Implementation Steps\n1. Define capabilities: streaming, token_reporting, system_prompt, auto_mode\n2. Add harness_supports(capability) function\n3. Implement for each harness based on spike findings\n4. Use in main loop to adapt behavior\n5. Log capabilities at startup in debug mode\n\n## Acceptance Criteria\n- [ ] Can query if harness supports streaming\n- [ ] Can query if harness reports tokens\n- [ ] Main loop adapts to capabilities\n- [ ] Degraded mode works when capability missing\n\n## Files Likely Involved\n- lib/harness.sh\n\n## Notes\nThis is a design task requiring careful consideration of the abstraction.\nExample: if harness doesn't report tokens, estimate from model pricing.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:27:05.675018-05:00","created_by":"lavallee","updated_at":"2026-01-10T05:32:25.375157-05:00","closed_at":"2026-01-10T05:32:25.375157-05:00","close_reason":"Implemented harness capability detection with harness_supports() function","labels":["complexity:high","logic","model:opus","phase-3"],"dependencies":[{"issue_id":"curb-kod","depends_on_id":"curb-3s0","type":"blocks","created_at":"2026-01-09T16:27:05.787038-05:00","created_by":"lavallee"},{"issue_id":"curb-kod","depends_on_id":"curb-lop","type":"blocks","created_at":"2026-01-09T16:27:05.837811-05:00","created_by":"lavallee"},{"issue_id":"curb-kod","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:35.196201-05:00","created_by":"lavallee"}]}
{"id":"curb-lop","title":"Implement OpenCode harness","description":"## Context\nAdd OpenCode as a supported harness based on spike findings.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Follow pattern from other harness implementations.\n\n## Implementation Steps\n1. Add opencode_invoke() function\n2. Add opencode_invoke_streaming() if supported\n3. Handle system prompt passing\n4. Add to harness_detect() priority list\n5. Update harness_available() check\n\n## Acceptance Criteria\n- [ ] curb --harness opencode works\n- [ ] System and task prompts passed correctly\n- [ ] Streaming mode if available\n- [ ] Falls back gracefully if not installed\n\n## Files Likely Involved\n- lib/harness.sh\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:27:05.497764-05:00","created_by":"lavallee","updated_at":"2026-01-10T05:26:35.944353-05:00","closed_at":"2026-01-10T05:26:35.944353-05:00","close_reason":"Implemented OpenCode harness with full support for invoke, streaming, and token usage tracking","labels":["complexity:medium","logic","model:sonnet","phase-3"],"dependencies":[{"issue_id":"curb-lop","depends_on_id":"curb-d9l","type":"blocks","created_at":"2026-01-09T16:27:05.616772-05:00","created_by":"lavallee"},{"issue_id":"curb-lop","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:35.145904-05:00","created_by":"lavallee"}]}
{"id":"curb-ohp","title":"Add log_task_start/end functions with metadata","description":"## Context\nEach task run should log start/end with rich metadata for debugging and analysis.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 20m\n**Approach:** Wrapper functions that capture timing and call logger_write with structured data.\n\n## Implementation Steps\n1. Add log_task_start(task_id, task_title, harness)\n2. Add log_task_end(task_id, exit_code, duration_sec, tokens_used)\n3. Add log_error(message, context)\n4. Capture git SHA at task end for traceability\n5. Store start time in variable for duration calculation\n\n## Acceptance Criteria\n- [ ] task_start event logged with task_id, title, harness\n- [ ] task_end event logged with duration, exit_code, tokens, git_sha\n- [ ] Errors logged with context\n\n## Files Likely Involved\n- lib/logger.sh\n\n## Notes\nUse $SECONDS bash variable for simple duration tracking\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:29.597266-05:00","created_by":"lavallee","updated_at":"2026-01-09T21:00:44.934226-05:00","closed_at":"2026-01-09T21:00:44.934226-05:00","close_reason":"Implemented log_task_start, log_task_end, and log_error functions with comprehensive test coverage. All 189 tests pass.","labels":["complexity:medium","logic","model:sonnet","phase-1"],"dependencies":[{"issue_id":"curb-ohp","depends_on_id":"curb-et7","type":"blocks","created_at":"2026-01-09T16:26:29.718274-05:00","created_by":"lavallee"},{"issue_id":"curb-ohp","depends_on_id":"curb-1gq","type":"parent-child","created_at":"2026-01-09T19:57:34.112225-05:00","created_by":"lavallee"}]}
{"id":"curb-rvl","title":"Add budget enforcement to main loop","description":"## Context\nMain loop needs to stop when budget is exceeded.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 20m\n**Approach:** After each task, record usage and check budget. Exit gracefully if over.\n\n## Implementation Steps\n1. After harness completes, get token usage\n2. Call budget_record with usage\n3. Call budget_check - if returns 1, exit loop\n4. Log budget status in task_end event\n5. Final message showing total tokens used\n\n## Acceptance Criteria\n- [ ] Loop stops when budget exceeded\n- [ ] Clear message: \"Budget exceeded (used X of Y tokens)\"\n- [ ] Remaining budget logged after each task\n- [ ] Graceful exit (not error code)\n\n## Files Likely Involved\n- curb (main script)\n- lib/budget.sh\n- lib/logger.sh\n\n## Notes\nExit with 0 (success) when stopping for budget - it's expected behavior\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:47.056855-05:00","created_by":"lavallee","updated_at":"2026-01-09T23:52:40.07845-05:00","closed_at":"2026-01-09T23:52:40.07845-05:00","close_reason":"Implemented budget enforcement in main loop - extracts token usage, records to budget, checks after each iteration, logs budget status, exits gracefully when exceeded","labels":["complexity:medium","logic","model:sonnet","phase-2"],"dependencies":[{"issue_id":"curb-rvl","depends_on_id":"curb-0ub","type":"blocks","created_at":"2026-01-09T16:26:47.215943-05:00","created_by":"lavallee"},{"issue_id":"curb-rvl","depends_on_id":"curb-0hz","type":"blocks","created_at":"2026-01-09T16:26:47.262362-05:00","created_by":"lavallee"},{"issue_id":"curb-rvl","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.683682-05:00","created_by":"lavallee"}]}
{"id":"curb-tw9","title":"Update harness priority configuration","description":"## Context\nUsers should be able to configure which harness to prefer.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 15m\n**Approach:** Read priority array from config, update harness_detect to respect it.\n\n## Implementation Steps\n1. Read harness.priority from config\n2. Update harness_detect() to check in priority order\n3. Document configuration in README\n4. Add example to default config\n\n## Acceptance Criteria\n- [ ] Config priority respected: [\"gemini\", \"claude\", \"codex\", \"opencode\"]\n- [ ] Falls through list until one is available\n- [ ] Documented in config schema\n\n## Files Likely Involved\n- lib/harness.sh\n- lib/config.sh\n\n## Notes\nDefault priority: claude, gemini, codex, opencode\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:27:06.070367-05:00","created_by":"lavallee","updated_at":"2026-01-10T06:07:22.35464-05:00","closed_at":"2026-01-10T06:07:22.35464-05:00","close_reason":"Implemented harness priority configuration with full test coverage, documentation, and examples. All 327 tests passing.","labels":["complexity:low","model:haiku","phase-3","setup"],"dependencies":[{"issue_id":"curb-tw9","depends_on_id":"curb-kod","type":"blocks","created_at":"2026-01-09T16:27:06.181875-05:00","created_by":"lavallee"},{"issue_id":"curb-tw9","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:35.296238-05:00","created_by":"lavallee"}]}
{"id":"curb-vdw","title":"Integrate clean state check into main loop","description":"## Context\nThe main loop needs to call state checks after each harness invocation.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 20m\n**Approach:** After harness returns, call state_ensure_clean. If fails, handle based on config.\n\n## Implementation Steps\n1. Source lib/state.sh in curb\n2. After harness_invoke completes, call state_ensure_clean\n3. If returns non-zero, log error and decide: continue or abort\n4. Add --require-clean flag override\n\n## Acceptance Criteria\n- [ ] Uncommitted changes detected after harness run\n- [ ] Loop aborts if require_commit and changes exist\n- [ ] Tests run if configured\n- [ ] Behavior overridable with CLI flag\n\n## Files Likely Involved\n- curb (main script)\n- lib/state.sh\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:46.366583-05:00","created_by":"lavallee","updated_at":"2026-01-09T23:37:16.37626-05:00","closed_at":"2026-01-09T23:37:16.37626-05:00","close_reason":"Integrated clean state check into main loop. Sources lib/state.sh, calls state_ensure_clean and state_run_tests after harness invocation. Handles failures appropriately. Added --require-clean and --no-require-clean CLI flags to override config. All 263 tests pass.","labels":["complexity:medium","logic","model:sonnet","phase-2"],"dependencies":[{"issue_id":"curb-vdw","depends_on_id":"curb-g21","type":"blocks","created_at":"2026-01-09T16:26:46.475689-05:00","created_by":"lavallee"},{"issue_id":"curb-vdw","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.476566-05:00","created_by":"lavallee"}]}
{"id":"curb-xo3","title":"Implement hooks.sh framework","description":"## Context\nHooks allow users to extend curb behavior without modifying core code.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Hook points are directories containing executable scripts. Run all scripts in order.\n\n## Implementation Steps\n1. Create lib/hooks.sh\n2. Add hooks_run(hook_name) - runs all scripts in hook_name.d/\n3. Export context variables before running\n4. Capture output and exit codes\n5. Log hook execution results\n\n## Acceptance Criteria\n- [ ] hooks_run \"pre-task\" executes scripts in pre-task.d/\n- [ ] Scripts receive context via environment vars\n- [ ] Hook failure logged but doesn't stop loop (configurable)\n- [ ] Scripts run in sorted order (01-first.sh before 02-second.sh)\n\n## Files Likely Involved\n- lib/hooks.sh (new)\n\n## Notes\nPattern: ~/.config/curb/hooks/pre-task.d/*.sh and .curb/hooks/pre-task.d/*.sh\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-09T16:27:04.480413-05:00","created_by":"lavallee","updated_at":"2026-01-10T04:45:04.462735-05:00","closed_at":"2026-01-10T04:45:04.462735-05:00","close_reason":"Implemented hooks.sh framework with 21 comprehensive tests. All acceptance criteria met.","labels":["complexity:medium","logic","model:sonnet","phase-3"],"dependencies":[{"issue_id":"curb-xo3","depends_on_id":"curb-fxr","type":"blocks","created_at":"2026-01-09T16:27:04.594492-05:00","created_by":"lavallee"},{"issue_id":"curb-xo3","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:34.837336-05:00","created_by":"lavallee"}]}
{"id":"curb-zlk","title":"Update README with new features","description":"## Context\nREADME needs to cover all 1.0 features for new users.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 30m\n**Approach:** Add sections for new features, update examples.\n\n## Implementation Steps\n1. Add Configuration section (global/project config)\n2. Add Hooks section with lifecycle diagram\n3. Add Budget section with usage examples\n4. Update Harnesses section with all 4\n5. Add Logging section\n\n## Acceptance Criteria\n- [ ] All new features documented\n- [ ] Examples for common use cases\n- [ ] Config schema documented\n- [ ] Quick start still works\n\n## Files Likely Involved\n- README.md\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:27:20.599917-05:00","created_by":"lavallee","updated_at":"2026-01-10T06:38:55.776409-05:00","closed_at":"2026-01-10T06:38:55.776409-05:00","close_reason":"Updated README with Budget Management section, Hook Lifecycle diagram, and verified all 1.0 features are documented with examples","labels":["complexity:low","docs","model:haiku","phase-4"],"dependencies":[{"issue_id":"curb-zlk","depends_on_id":"curb-ch2","type":"blocks","created_at":"2026-01-09T16:27:20.706553-05:00","created_by":"lavallee"},{"issue_id":"curb-zlk","depends_on_id":"curb-9pe","type":"parent-child","created_at":"2026-01-09T19:57:35.445249-05:00","created_by":"lavallee"}]}
{"id":"curb-zrg","title":"Add hook directory scanning","description":"## Context\nHooks live in multiple directories (global and project). Need to find and merge them.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 20m\n**Approach:** Scan both global and project hook dirs, collect executable files.\n\n## Implementation Steps\n1. Add hooks_find(hook_name) - returns list of scripts to run\n2. Check ~/.config/curb/hooks/{hook_name}.d/\n3. Check .curb/hooks/{hook_name}.d/\n4. Filter to executable files only\n5. Sort by filename for ordering\n\n## Acceptance Criteria\n- [ ] Finds hooks in global directory\n- [ ] Finds hooks in project directory\n- [ ] Merges both (global runs first)\n- [ ] Only returns executable files\n\n## Files Likely Involved\n- lib/hooks.sh\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:27:04.652904-05:00","created_by":"lavallee","updated_at":"2026-01-10T04:53:49.754537-05:00","closed_at":"2026-01-10T04:53:49.754537-05:00","close_reason":"Implemented hooks_find() function to scan and return executable hook scripts from both global and project directories. Added comprehensive test coverage with 4 acceptance criteria tests. All 301 tests pass.","labels":["complexity:low","logic","model:haiku","phase-3"],"dependencies":[{"issue_id":"curb-zrg","depends_on_id":"curb-xo3","type":"blocks","created_at":"2026-01-09T16:27:04.758736-05:00","created_by":"lavallee"},{"issue_id":"curb-zrg","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:34.887903-05:00","created_by":"lavallee"}]}

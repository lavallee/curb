diff --git a/curb b/curb
index 85a8b66..0ef626a 100755
--- a/curb
+++ b/curb
@@ -147,9 +147,13 @@ check_deps() {
 validate_project() {
     log_debug "Validating project structure in ${PROJECT_DIR}"
 
-    # Detect task backend
+    # Detect and initialize task backend
+    # Note: tasks.sh is already sourced at top of script, defining _TASK_BACKEND global
+    # detect_backend echoes the result AND sets _TASK_BACKEND, but command substitution
+    # runs in subshell, so we explicitly set the global after getting the value
     local detected_backend
     detected_backend=$(detect_backend "${PROJECT_DIR}")
+    _TASK_BACKEND="$detected_backend"  # Explicitly set global to persist across function calls
     log_debug "Task backend: ${detected_backend}"
 
     if [[ "$detected_backend" == "beads" ]]; then
@@ -182,7 +186,7 @@ validate_project() {
 # Show task status summary
 show_status() {
     local prd="${PROJECT_DIR}/prd.json"
-    local backend=$(get_backend)
+    local backend=$(get_backend "${PROJECT_DIR}")
 
     # Validate JSON before processing (only for json backend)
     if [[ "$backend" == "json" ]]; then
@@ -224,7 +228,7 @@ show_status() {
 # Show ready tasks
 show_ready() {
     local prd="${PROJECT_DIR}/prd.json"
-    local backend=$(get_backend)
+    local backend=$(get_backend "${PROJECT_DIR}")
 
     # Validate JSON before processing (only for json backend)
     if [[ "$backend" == "json" ]]; then
@@ -296,12 +300,32 @@ run_iteration() {
     local prd="${PROJECT_DIR}/prd.json"
     log_debug "Starting iteration"
 
+    # Initialize session if not already initialized
+    if ! session_is_initialized; then
+        log_debug "Initializing session..."
+        if [[ -n "$SESSION_NAME" ]]; then
+            session_init --name "$SESSION_NAME"
+        else
+            session_init
+        fi
+
+        if [[ $? -ne 0 ]]; then
+            log_warn "Failed to initialize session"
+        else
+            local session_name
+            session_name=$(session_get_name)
+            local session_id
+            session_id=$(session_get_id)
+            log_debug "Session: ${session_name} (${session_id})"
+        fi
+    fi
+
     # Initialize logger if not already initialized
     if [[ -z "$(logger_get_file)" ]]; then
         local project_name
         project_name=$(basename "$PROJECT_DIR")
         local session_id
-        session_id=$(date +"%Y%m%d-%H%M%S")
+        session_id=$(session_get_id)
 
         if logger_init "$project_name" "$session_id"; then
             log_debug "Logger initialized: $(logger_get_file)"
@@ -310,6 +334,18 @@ run_iteration() {
         fi
     fi
 
+    # Initialize artifacts for this run if not already initialized
+    if session_is_initialized && [[ -z "$(artifacts_get_run_dir 2>/dev/null)" ]]; then
+        log_debug "Initializing artifacts..."
+        if artifacts_init_run; then
+            local artifacts_path
+            artifacts_path=$(artifacts_get_run_dir)
+            log_debug "Artifacts initialized: ${artifacts_path}"
+        else
+            log_warn "Failed to initialize artifacts"
+        fi
+    fi
+
     # Check for in-progress tasks first (resume interrupted work)
     # Respects --epic and --label filters
     local current_task
@@ -338,6 +374,7 @@ run_iteration() {
     if [[ -z "$current_task" || "$current_task" == "null" ]]; then
         # Find next ready task
         log_debug "No in-progress tasks, finding ready tasks..."
+        log_debug "Current _TASK_BACKEND: ${_TASK_BACKEND}"
         local ready_tasks
         ready_tasks=$(get_ready_tasks "$prd" "$EPIC" "$LABEL")
         log_debug "Ready tasks result: ${ready_tasks:0:200}..."
diff --git a/lib/tasks.sh b/lib/tasks.sh
index 3172d53..8a4951f 100755
--- a/lib/tasks.sh
+++ b/lib/tasks.sh
@@ -11,6 +11,12 @@
 #   - Auto-detect: uses beads if available and initialized, else json
 #
 
+# Include guard to prevent re-sourcing and resetting _TASK_BACKEND
+if [[ -n "${_TASKS_SH_LOADED:-}" ]]; then
+    return 0
+fi
+_TASKS_SH_LOADED=1
+
 CURB_LIB_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
 
 # Source beads wrapper if available
@@ -67,9 +73,11 @@ detect_backend() {
 }
 
 # Get the current backend
+# Optional parameter: project_dir (defaults to current directory)
 get_backend() {
+    local project_dir="${1:-.}"
     if [[ -z "$_TASK_BACKEND" ]]; then
-        detect_backend >/dev/null
+        detect_backend "$project_dir" >/dev/null
     fi
     echo "$_TASK_BACKEND"
 }
@@ -116,7 +124,12 @@ get_ready_tasks() {
     local epic="${2:-}"   # Optional epic/parent filter
     local label="${3:-}"  # Optional label filter
 
-    if [[ "$(get_backend)" == "beads" ]]; then
+    local backend=$(get_backend)
+    if [[ "${DEBUG:-}" == "true" ]]; then
+        echo "[DEBUG get_ready_tasks] backend=$backend prd=$prd _TASK_BACKEND=$_TASK_BACKEND" >&2
+    fi
+
+    if [[ "$backend" == "beads" ]]; then
         beads_get_ready_tasks "$epic" "$label"
     else
         json_get_ready_tasks "$prd" "$epic" "$label"
@@ -262,7 +275,12 @@ json_get_ready_tasks() {
     local epic="${2:-}"
     local label="${3:-}"
 
-    jq --arg epic "$epic" --arg label "$label" '
+    if [[ "${DEBUG:-}" == "true" ]]; then
+        echo "[DEBUG json_get_ready_tasks] prd=$prd epic=$epic label=$label" >&2
+    fi
+
+    local result
+    result=$(jq --arg epic "$epic" --arg label "$label" '
         # Build a set of closed task IDs
         (.tasks | map(select(.status == "closed") | .id)) as $closed |
 
@@ -280,7 +298,13 @@ json_get_ready_tasks() {
         ]
         # Sort by priority (P0 < P1 < P2 < P3 < P4)
         | sort_by(.priority)
-    ' "$prd"
+    ' "$prd" 2>&1)
+
+    if [[ "${DEBUG:-}" == "true" ]]; then
+        echo "[DEBUG json_get_ready_tasks] result=${result:0:200}" >&2
+    fi
+
+    echo "$result"
 }
 
 # Get a specific task by ID from prd.json
